<!DOCTYPE html>
<html>
<head>
   <title>Database Test</title>
   <style>
       .success { color: green; font-weight: bold; }
       .error { color: red; font-weight: bold; }
       .test-status { padding: 10px; margin: 5px; border-radius: 4px; }
   </style>
</head>
<body>
   <div id="results"></div>

   <script type="module">
       import { DatabaseClient } from 'limbo-wasm';

       function log(message, isError = false) {
           const div = document.createElement('div');
           div.className = `test-status ${isError ? 'error' : 'success'}`;
           div.textContent = typeof message === 'string' ? message : JSON.stringify(message, null, 2);
           document.getElementById('results').appendChild(div);
       }

       async function runTests() {
           const db = new DatabaseClient();

           try {
               log('Starting up');
               await db.init('test.db');
               log('Database initialized');

               await db.exec(`
                   CREATE TABLE users (id INTEGER PRIMARY KEY, name TEXT, email TEXT);
               `);
               log('Table created');

               await db.exec(`
                   INSERT INTO users VALUES (1, 'Alice', 'alice@example.org');
               `);
               await db.exec(`
                   INSERT INTO users VALUES (2, 'Bob', 'bob@example.org');

               `);
               await db.exec(`
                   INSERT INTO users VALUES (3, 'bill', 'bill@example.com');
               `);
               log('Data inserted');

               const stmt = await db.prepare('SELECT * FROM users;');
               const results = await stmt.all();
               log('Query results: ' + JSON.stringify(results));

               db.close();
               log('All tests completed successfully');
           } catch (error) {
               log(`Test failed: ${error.message}`, true);
           }
       }

       runTests();
   </script>
</body>
</html>
